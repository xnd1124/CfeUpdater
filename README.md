# Анализ расширения при обновлении
При доработке конфигураций, находящихся на поддержке через расширения возникают проблемы изменения расширенных методов при выпуске вендором новых версий основной конфигурации.
Часть проблем можно решить используя директиву ```&ИзменениеиКонтроль```, однако при использовании директив ```&Вместо```,```&После``` и ```&Перед``` нет типовых средств позволяющих понять, а не потеряло ли расширение актуальность, не требуется ли доработка переопределенных методов.
Также типовая проверка применимости принципиально не работает с переопределенными событиями форм и их реквизитов.
<br>

Предлагаемое решение представляет собой внешнюю обработку (**CfeUpdater.epf**), позволяющую увидеть и исправить все проблемные и потенциально проблемные места в расширении, связанном с основной конфигурацией при обновлении последней на новый релиз.
Обработка сравнивает методы, а не модули целиком.
Также обработка при помощи утилиты git (git-merge) пытается автоматически применить изменения из новой версии конфигурации если не были обнаружены конфликты.
<br>

Обработка использует для разбора текстов с помощью регулярных выражений внешнюю компоненту https://github.com/alexkmbk/RegEx1CAddin и работает как Windows, так и в Linux системах.
# Как пользоваться
1. Выгрузить основную конфигурацию до обновления в файлы (через конфигуратор или при помощи автономного сервера), аналогичным образом необходимо поступить с новой конфигурацией (новый релиз обновляемой конфигурации) и собственно с самим расширением.
2. Открыть в любой конфигурации, содержащей БСП в режиме 1С: Предприятия обработку CfeUpdater.epf
3. При первом запуске возникнет запрос на разрешение подключения внешней компоненты RegEx, отвечаем "Да"
![image](https://github.com/user-attachments/assets/f5048657-4065-4e3a-bf9e-18784ebef71f)
4. Так же при первом запуске автоматически откроется окно настроек, предлагающее выбрать какую программу использовать для просмотра изменений, указать ее место расположение, а также указать расположение стандартного клиента git.
![image](https://github.com/user-attachments/assets/64380941-ab53-4070-918b-7a4e84bb1d58)
Рекомендуется выбрать Kdiff3 https://download.kde.org/stable/kdiff3/ (более богатые возможности по просмотру изменений) и стандартный консольный git клиент https://git-scm.com
![image](https://github.com/user-attachments/assets/832769fd-9345-4065-9f24-a250054e00c8)

5. После закрытия настроек в основной форме указать путь к каталогам с выгруженными конфигурациями и расширением, созданным на этапе 1.
![image](https://github.com/user-attachments/assets/39c119ec-8f72-46cb-8dc8-a2b498c7ad25)


6. Результат обновления расширения сохраняются в виде xml файлов. Для этого необходимо указать пустой каталог, в который будут автоматически скопированны исходные файл расширения и произведены необходимые изменения.
![image](https://github.com/user-attachments/assets/7f62c142-9f02-4175-bb07-fdf98ca8b63f)


7. Нажать кнопку Анализ и дождаться его завершения ( несколько секунд)
![image](https://github.com/user-attachments/assets/e8b76368-0ebe-46a4-a671-eeae46f5a92f)

8. Результат анализа выводится на разных вкладках. На вкладке "Проблемы" показаны критические проблемы, из-за которых расширение не будет применено или будет работать некорректно
   ![image](https://github.com/user-attachments/assets/88f0d6f6-a395-46a0-9200-a48b14a8bfd6)
Результат предсатвлен в виде дерева, строки которого указывают на проблемные методы.
Часть проблем могут быть разрешены автоматически при помощи git, они отмечены в колонке "Авто", остальные требуют запуска программы сравнения. Это можно сделать либо двойным щелчком или выбрав команду "Объединить"
![image](https://github.com/user-attachments/assets/a47866ca-9e91-4fc7-8cf3-e3f77ed9b68f).
  После этого запустится настроенная программа просмотра изменений (на  скрине Kdiff3), в которой необходимо будет разрешить конфликт обновления.
![image](https://github.com/user-attachments/assets/218145a6-6609-4bf9-ae68-235ce15ae162)
Результат внесенных изменений автоматически записывается в каталог с результатами объединения, указанный в п.6

 P.S. Просмотреть результат объединения можно по команде "Показать результат объединения" 
 ![image](https://github.com/user-attachments/assets/9db7bb75-e664-4797-9386-9971af4ec583). 
 Т.к. повторное нажатие "Объединить" сбрасывает результаты прошлого объединения и производит его заново.

9. Вкладка "Информация" отображает методы, которые были переопределены при помощи директив "После" или "Перед" и позволяет просмотреть не повлияли ли изменения в конфигурации на логику в расширении.
![image](https://github.com/user-attachments/assets/ce7e1298-5439-4e32-ab29-c0d628b960da)
Тут при показ отличий открывается программа просмотра изменений без возможности объединения, она носит информационный характер. Все изменения в расширении необходимо будет сделать в среде разработки.
![image](https://github.com/user-attachments/assets/7c73659c-2567-4ef3-9c42-e14401c8480f)

10. После разрешения вопросов по проблемным методам (можно помечать их флажком в колонке "Отм.")
 ![image](https://github.com/user-attachments/assets/6516da9d-7251-491c-aecf-eaedecba4869)

Необходимо в конфигураторе загрузить конфигурацию из файлов, выбрав каталог с результатами, указанный в п.6



# Ограничения
1. Анализируются исходники в формате конфигуратора 
2. Для просмотра изменений поддерживаются только Kdiff3, P4Merge
3. Для автообъединения поддерживается только Git
